//server-only

//external procedure PrintStockStat1(array val,array val,array val,integer);
//external procedure PrintStockIn2(array val,array val,array val,integer);
//external procedure PrintStockCLOut31(val,val,val,val,integer);
//external procedure PrintStockSD32(integer,date,date,string,array string);
//external procedure PrintCLIn43(integer,date,date,string,array string);
//external procedure PrintStockRet46(array val,array val,array val,integer);
//external procedure PrintStockSel47(array val,array val,array val,integer);
//external procedure PrintStockVECred7(date,array val,array val,array val,array val,array val,array val,array val,array val,integer,var val);
//external procedure PrintStockIVDeb8(date,vector val,vector val,vector val,vector val,vector val,vector val,vector val,vector val,vector val,vector val,integer,var val);
//external procedure PrintStockRetFob9(integer,date,date,string,array string);

external procedure GetFindCustBalance(string,LongInt,var val,var val,var val,var val,Integer,Integer,Integer,Integer,Integer,Integer,Boolean,var Boolean);
external procedure GetFullCurncyRate (var string,Date,var val,var val,var val,var val,var val);
external procedure GetOnAccBalance(record RcVc,string,string,Boolean,Integer,var val,var val,var val,var val,var val,var val,var val,record SMVc,
                   Array string,Array val,var Integer);
external procedure PrintStockStat1(integer,date,date,string,array string,var val);
external procedure PrintStockIn2(integer,date,date,string,array string);
external procedure PrintStockCLOut312(integer,date,date,string,array string);
external procedure PrintCashIn4123(integer,date,date,string,array string,var val);
external procedure PrintCUDEb445(date,date,string,integer,array string,var val);
external procedure PrintCashIn46(integer,date,date,string,array string,var val);
external procedure PrintStockSelRet478(integer,date,date,string,array string,var val);
external procedure PrintCLIn512(integer,date,date,string,array string,var val);
external procedure PrintStockVEPAy6(date,date,integer,array string);
external procedure PrintCLOut61(integer,date,date,string,array string);
external procedure PrintStockFromBrandManag7(record RcVc,array string,var val);
external procedure PrintStockIVDeb8(date,string,array string,var val);
external procedure PrintStockRetFob9New(integer,date,date,string,array string);
external procedure PrintRates10(date);

SetLangMode(LangRussian,"RUS",0);

global procedure MegaBalanceRn(record RcVc RepSpec)
begin
  array string 100 aBrands;
  integer brandscnt;
  record DIVc DIr;
  integer i,mtrw;	
  string 50 location;
  Date sd,ed;
  val totusd;
  record MegaBalanceBlock MBb;
  row MegaBalanceBlock MBrw;
  val sumusd;
	
	blockload(MBb);

	sd = RepSpec.sStartDate;
	ed = RepSpec.sEndDate;
	brandscnt = 0;
	mtrw = matrowcnt(MBb);
	For(i=0;i<mtrw;i=i+1) begin
	  matrowget(MBb,i,MBrw);
	  if(nonblank(MBrw.Brand))then begin
	  	aBrands[brandscnt] = MBrw.Brand;
			brandscnt = brandscnt + 1;
	  end;
	end; 
	
	location = RepSpec.f1;
	
	startreportnoheaderjob("Баланс");
	
		startformat(15);
			outstring(0,0,"",false);
			outstring(0,0,"Баланс " & RepSpec.sStartDate & " - " & RepSpec.sEndDate,false);
			outstring(100,0,"Всего",false);
			For(i=0;i<brandscnt;i=i+1) begin
	  		outstring(150+i*50,0,aBrands[i],false);
			end; 
		endformat;
		startformat(15);
			outstring(0,0,"",false);
			outstring(0,0,"Статья баланса",false);
		endformat;
		
		PrintStockStat1(brandscnt,sd,ed,location,aBrands,totusd);
    PrintStockIn2(brandscnt,sd,ed,location,aBrands);
		PrintStockCLOut312(brandscnt,sd,ed,location,aBrands);
		PrintCashIn4123(brandscnt,sd,ed,location,aBrands,sumusd);
		PrintCUDEb445(sd,ed,location,brandscnt,aBrands,sumusd);
		PrintCashIn46(brandscnt,sd,ed,location,aBrands,sumusd);
		PrintStockSelRet478(brandscnt,sd,ed,location,aBrands,sumusd);
		PrintCLIn512(brandscnt,sd,ed,location,aBrands,totusd);
    PrintStockVEPAy6(sd,ed,brandscnt,aBrands);
		PrintCLOut61(brandscnt,sd,ed,location,aBrands);
    PrintStockFromBrandManag7(RepSpec,aBrands,totusd);
    PrintStockIVDeb8(ed,RepSpec.f1,aBrands,totusd);
    PrintStockRetFob9New(brandscnt,sd,ed,location,aBrands);
		
    startformat(15);
			outstring(0,0,"10",false);
			outstring(50,0,"АКТИВ",false);
			outstring(150,0,totusd,false);
		endformat;
		
		PrintRates10(ed);

    endjob;
	
	
return;
end;